{% import "macros/utils.jinja2" as utils %}
// SPDX-License-Identifier: Apache-2.0
// AUTOMATICALLY GENERATED FILE - DO NOT EDIT
//
// C++20 Module Interface for {{ package_name }} datamodel
// This module exports all generated datatypes, collections, and components

module;

// Global module fragment - include all necessary headers
#include <algorithm>
#include <array>
#include <cstddef>
#include <cstdint>
#include <memory>
#include <mutex>
#include <ostream>
#include <string>
#include <string_view>
#include <vector>

// Podio core headers (module-safe - no ROOT dependencies)
#include "podio/CollectionBase.h"
#include "podio/ICollectionProvider.h"
#include "podio/SchemaEvolution.h"
#include "podio/CollectionBuffers.h"
#include "podio/utilities/MaybeSharedPtr.h"
#include "podio/detail/OrderKey.h"

#if defined(PODIO_JSON_OUTPUT) && !defined(__CLING__)
#include "nlohmann/json_fwd.hpp"
#endif

// Include all component headers
{% for comp in components %}
#include "{{ incfolder }}{{ comp.bare }}.h"
{% endfor %}

// Include all datatype headers (Object, MutableObject, Collection, etc.)
{% for dt in datatypes %}
#include "{{ incfolder }}{{ dt.bare }}.h"
#include "{{ incfolder }}Mutable{{ dt.bare }}.h"
#include "{{ incfolder }}{{ dt.bare }}Obj.h"
#include "{{ incfolder }}{{ dt.bare }}Data.h"
#include "{{ incfolder }}{{ dt.bare }}Collection.h"
#include "{{ incfolder }}{{ dt.bare }}CollectionData.h"
{% endfor %}

// Include all interface headers
{% for iface in interfaces %}
#include "{{ incfolder }}{{ iface.bare }}.h"
{% endfor %}

// Include all link headers
{% for link in links %}
#include "{{ incfolder }}{{ link.bare }}Collection.h"
{% endfor %}

export module {{ package_name }}.datamodel;

// Re-export podio core types that are used in the datamodel
export namespace podio {
  using podio::CollectionBase;
  using podio::ICollectionProvider;
  using podio::SchemaEvolution;
  using podio::SchemaVersionT;
}

// Export all components
{% if components %}
export namespace {{ package_name }} {
{% for comp in components %}
{% if comp.ns %}
  using {{ comp.ns }}::{{ comp.bare }};
{% else %}
  using ::{{ comp.bare }};
{% endif %}
{% endfor %}
}
{% endif %}

// Export all datatypes (Object, MutableObject, Collection)
{% for dt in datatypes %}
export namespace {{ package_name }} {
  // {{ dt.full }} datatype
{% if dt.ns %}
  using {{ dt.ns }}::{{ dt.bare }};
  using {{ dt.ns }}::Mutable{{ dt.bare }};
  using {{ dt.ns }}::{{ dt.bare }}Collection;
  using {{ dt.ns }}::{{ dt.bare }}CollectionIterator;
  using {{ dt.ns }}::{{ dt.bare }}MutableCollectionIterator;  // Note: pattern is {Type}MutableCollectionIterator
  // Note: {{ dt.bare }}Obj, {{ dt.bare }}Data, and {{ dt.bare }}CollectionData are internal implementation
  // details and are not exported. They are only accessible through the public handle and collection APIs.
{% else %}
  using ::{{ dt.bare }};
  using ::Mutable{{ dt.bare }};
  using ::{{ dt.bare }}Collection;
  using ::{{ dt.bare }}CollectionIterator;
  using ::{{ dt.bare }}MutableCollectionIterator;  // Note: pattern is {Type}MutableCollectionIterator
  // Note: {{ dt.bare }}Obj, {{ dt.bare }}Data, and {{ dt.bare }}CollectionData are internal implementation
  // details and are not exported. They are only accessible through the public handle and collection APIs.
{% endif %}
}
{% endfor %}

// Export all interfaces
{% if interfaces %}
export namespace {{ package_name }} {
{% for iface in interfaces %}
{% if iface.ns %}
  using {{ iface.ns }}::{{ iface.bare }};
{% else %}
  using ::{{ iface.bare }};
{% endif %}
{% endfor %}
}
{% endif %}

// Export all link collections
{% if links %}
export namespace {{ package_name }} {
{% for link in links %}
{% if link.ns %}
  using {{ link.ns }}::{{ link.bare }}Collection;
{% else %}
  using ::{{ link.bare }}Collection;
{% endif %}
{% endfor %}
}
{% endif %}

// Export type lists for introspection
export namespace {{ package_name }} {
  // Note: TypeList definitions are in {{ package_name }}.h header
  // They cannot be directly exported from modules due to template complexities
}
